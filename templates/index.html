<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Music VR</title>
  <!-- A-Frame CDN -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- Custom Scripts -->
  <script src="{{ url_for('static', filename='js/forestController.js') }}"></script>
  <script src="{{ url_for('static', filename='js/moonController.js') }}"></script>
  <script src="{{ url_for('static', filename='js/starsController.js') }}"></script>

</head>

<body>
  <a-scene fog="type: linear; color: #151520; near: 30; far: 120">
    <!-- Forest Generator (Auditorium + Outside) -->
    <a-entity
      forest-generator="count: 50; treeModel: url({{ url_for('static', filename='assets/3Dmodels/pine_tree_game-ready.glb') }}); autoStart: false">
    </a-entity>

    <!-- Moon -->
    <a-entity id="moon" gltf-model="url({{ url_for('static', filename='assets/3Dmodels/moon/scene.gltf') }})"
      position="50 150 -50" scale="0.5 0.5 0.5" moon-controller>
    </a-entity>
    <!-- Assets -->
    <a-assets>
      <img id="sky" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg">
    </a-assets>

    <!-- Camera / User -->
    <a-entity position="0 1.6 0">
      <a-camera look-controls wasd-controls="fly: true; acceleration: 100"></a-camera>
    </a-entity>

    <!-- Environment -->
    <a-sky color="#0f0f15"></a-sky> <!-- Dark premium background -->

    <!-- Stars -->
    <a-entity star-system="count: 5000; radius: 400; color: #FFF"></a-entity>

    <!-- Lighting -->
    <a-light type="ambient" color="#BBB"></a-light>
    <a-light type="directional" position="1 10 1" intensity="0.5"></a-light>
    <a-light type="spot" position="0 20 0" rotation="-90 0 0" color="#fff" intensity="1.5" angle="45"
      penumbra="0.3"></a-light>

    <!-- Main Stage (CENTER) - Radius ~15m -->
    <a-cylinder position="0 0.5 0" radius="15" height="1" color="#fff" material="roughness: 0.2; metalness: 0.8">
      <!-- Glow edge -->
      <a-torus radius="15" radius-tubular="0.2" rotation="90 0 0" color="#0F0F0F"
        material="emissive: #ffd200; emissiveIntensity: 2"></a-torus>
    </a-cylinder>

    <!-- Auditorium Seating (Raked seating effect) -->
    <!-- Tier 1 -->
    <a-ring position="0 1.5 0" rotation="-90 0 0" radius-inner="18" radius-outer="22" color="#333"
      material="side: double"></a-ring>
    <a-cylinder position="0 1 0" radius="22" height="2" open-ended="true" color="#222" material="side: double"
      theta-length="360"></a-cylinder>

    <!-- Tier 2 -->
    <a-ring position="0 3 0" rotation="-90 0 0" radius-inner="22" radius-outer="26" color="#444"
      material="side: double"></a-ring>
    <a-cylinder position="0 2.5 0" radius="26" height="5" open-ended="true" color="#2a2a2a" material="side: double"
      theta-length="360"></a-cylinder>

    <!-- Tier 3 -->
    <a-ring position="0 4.5 0" rotation="-90 0 0" radius-inner="26" radius-outer="30" color="#555"
      material="side: double"></a-ring>
    <a-cylinder position="0 4 0" radius="30" height="8" open-ended="true" color="#333" material="side: double"
      theta-length="360"></a-cylinder>

    <!-- Tier 4 (Outer limit ~60m diameter) -->
    <a-ring position="0 6 0" rotation="-90 0 0" radius-inner="30" radius-outer="35" color="#666"
      material="side: double"></a-ring>


    <!-- Fog Barrier / "Doughnut" around the stage -->
    <a-torus position="0 0 0" rotation="-90 0 0" radius="70" radius-tubular="8" color="#111"
      material="opacity: 0.45; transparent: true; roughness: 1"></a-torus>

    <!-- Floor under everything -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#050505"></a-plane>


  </a-scene>
</body>
<script>
  // Event Relay: Make the moon respond to the same events as the forest
  const forest = document.querySelector('[forest-generator]');
  const moon = document.querySelector('#moon');

  // TRIGGER MOON FIRST (Test)
  setTimeout(() => {
    console.log('Moon Growing...');
    if (moon) moon.emit('start-growth');
  }, 1000);

  setTimeout(() => {
    console.log('Moon Shrinking...');
    if (moon) moon.emit('start-shrink');
  }, 15000);

  // Auto-trigger for demo (User can remove this)
  setTimeout(() => {
    console.log('Growing...');
    forest.emit('start-growth');
  }, 1500);

  setTimeout(() => {
    console.log('Shrinking...');
    forest.emit('start-shrink');
  }, 10000);

</script>

</html>